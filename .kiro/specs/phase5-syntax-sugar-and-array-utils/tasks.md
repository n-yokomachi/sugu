# Implementation Plan

- [x]1. 新しい演算子トークンの追加と字句解析器の拡張
- [x]1.1 インクリメント・デクリメントと複合代入の 7 トークンを定義し、字句解析で認識する
  - `++`、`--` の 2 文字トークンを定義する
  - `+=`、`-=`、`*=`、`/=`、`%=` の 2 文字トークンを定義する
  - 字句解析器が `+` の次に `+` または `=` がある場合に正しいトークンを生成することを確認する
  - `-`、`*`、`/`、`%` についても同様に `=` が続く場合の認識を追加する
  - 既存のトークン（`+`、`-`、`==`、`!=` 等）への影響がないことを回帰テストで検証する
  - _Requirements: 1.6, 2.9_

- [x]2. 後置インクリメント・デクリメント演算子の実装
- [x]2.1 後置 `++` / `--` の構文解析を実装する
  - 後置演算子用の AST ノード（演算子と対象変数を保持）を定義する
  - 構文解析器の中置演算子テーブルに `++` と `--` を登録し、後置式としてパースする
  - 後置演算子の対象が識別子であることを検証する
  - 単独の `x++` と式内の `arr[i++]` がそれぞれ正しくパースされることをテストする
  - 既存の for 文やその他の式パースに影響がないことを回帰テストで確認する
  - _Requirements: 1.5_

- [x]2.2 後置 `++` / `--` の評価ロジックを実装する
  - 変数の現在値を取得し、1 を加算（`++`）または減算（`--`）した値で更新する
  - 更新前の値を式の結果として返す（後置セマンティクス）
  - `const` 変数に対して使用した場合は再代入エラーを返す
  - 数値型でない変数に対して使用した場合は型エラーを返す
  - `for` ループの更新式（`for (mut i = 0; i < 10; i++)` ）で正しく動作することをテストする
  - _Requirements: 1.1, 1.2, 1.3, 1.4_

- [x]3. 複合代入演算子の実装
- [x]3.1 変数に対する複合代入（`+=`、`-=`、`*=`、`/=`、`%=`）の構文解析を実装する
  - 複合代入用の AST ノード（演算子、対象変数、右辺式を保持）を定義する
  - 構文解析器の代入分岐を拡張し、`+=` 等のトークンを認識して複合代入ノードを生成する
  - 各演算子で正しい AST が生成されることをテストする
  - _Requirements: 2.10_

- [x]3.2 インデックス式に対する複合代入（`arr[i] += y`）の構文解析を実装する
  - インデックス複合代入用の AST ノード（対象式、インデックス、演算子、右辺式を保持）を定義する
  - 構文解析器の代入分岐で左辺がインデックス式の場合にインデックス複合代入ノードを生成する
  - 配列要素とマップ要素の両方で正しくパースされることをテストする
  - _Requirements: 2.10_

- [x]3.3 複合代入演算子の評価ロジックを実装する
  - 変数の現在値と右辺を対応する算術演算で計算し、結果を変数に代入する
  - `+=` で文字列同士の場合は文字列結合として処理する
  - `const` 変数に対する複合代入は再代入エラーを返す
  - `/=` または `%=` で右辺が 0 の場合はゼロ除算エラーを返す
  - インデックス式に対する複合代入（`arr[0] += 1`、`map["key"] -= 2`）が正しく動作することをテストする
  - 各演算子の正常系・異常系テストを実装する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 2.5, 2.6, 2.7, 2.8_

- [x]4. (P) 負のインデックスによる末尾アクセスの実装
  - 配列のインデックス評価で負の値を受け取った場合、配列長を加算して末尾からの相対位置に変換する
  - 文字列のインデックス評価でも同様に rune 単位で負インデックスを変換する
  - 変換後のインデックスがまだ負の場合は `null` を返す（読み取り時）
  - 配列の負インデックスへの代入を実装し、変換後の位置の要素を更新する
  - 代入時に変換後のインデックスが範囲外の場合は範囲外エラーを返す
  - `arr[-1]` で最後の要素、`str[-1]` で最後の文字が取得できることをテストする
  - 範囲超過（`arr[-100]`）で `null` が返ることをテストする
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.5, 3.6_

- [x]5. スライス操作の実装
- [x]5.1 スライス式の構文解析を実装する
  - スライス用の AST ノード（対象式、開始インデックス、終了インデックスを保持）を定義する
  - インデックス式のパース中にコロン `:` を検出した場合、スライス式としてパースする
  - 開始・終了の省略パターン（`arr[1:3]`、`arr[:3]`、`arr[1:]`、`arr[:]`）を全てサポートする
  - 通常のインデックス式（`arr[0]`）が影響を受けないことを回帰テストで確認する
  - 各省略パターンが正しい AST を生成することをテストする
  - _Requirements: 4.9_

- [x]5.2 スライス式の評価ロジックを実装する
  - 配列に対して指定範囲の要素を含む新しい配列を返す
  - 文字列に対して rune 単位で指定範囲の部分文字列を返す
  - 開始が省略された場合は 0、終了が省略された場合は長さとして処理する
  - 負のインデックスを長さ基準で正のインデックスに変換する
  - 範囲が長さを超える場合は利用可能な範囲に自動クランプする（エラーにしない）
  - 元の配列・文字列を変更せず、常に新しいオブジェクトを返す
  - 全パターン（完全指定、省略、負インデックス、クランプ、空結果、マルチバイト文字列）のテストを実装する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.5, 4.6, 4.7, 4.8_

- [x]6. 配列ユーティリティ関数の実装
- [x]6.1 (P) 配列・文字列の包含判定関数 `contains` を実装する
  - 第 1 引数が配列の場合、各要素と第 2 引数を比較して一致があれば `true` を返す
  - 第 1 引数が文字列の場合、部分文字列が含まれていれば `true` を返す
  - 見つからない場合は `false` を返す
  - 引数が 2 つでない場合は引数エラー、第 1 引数が配列でも文字列でもない場合は型エラーを返す
  - マルチバイト文字列での検索が正しく動作することをテストする
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6_

- [x]6.2 (P) 複数の配列を結合する関数 `concat` を実装する
  - 2 つ以上の配列を受け取り、全要素を順に結合した新しい配列を返す
  - 元の配列を変更しない（不変データ操作パターンに準拠）
  - 空配列が含まれる場合も正しく処理する
  - 引数が 2 つ未満の場合は引数エラー、配列以外の引数がある場合は型エラーを返す
  - 結合後の配列が元の配列と独立していることをテストする
  - _Requirements: 6.1, 6.2, 6.3, 6.4, 6.5, 6.6_

- [x]7. 仕様ドキュメントの更新
  - `docs/specification.md` に後置演算子、複合代入演算子、負のインデックス、スライス操作、`contains`、`concat` の仕様を追記する
  - `docs/index.md` のクイックリファレンスに新機能を追加する
  - `docs/backlog.md` から実装済みの課題（負のインデックス、`concat`/`contains`）を削除する
  - _Requirements: 7.1, 7.2, 7.3_
