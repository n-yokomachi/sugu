# Implementation Plan

- [x] 1. 剰余演算子の仕様確認とテスト強化
- [x] 1.1 剰余演算子の浮動小数点テストを追加し、仕様ドキュメントを更新する
  - 浮動小数点剰余（`5.5 % 2.0` → `1.5`）の動作確認テストを追加する
  - 整数剰余（`10 % 3` → `1`）が従来通り動作することを検証するテストを追加する
  - ゼロ除算（`x % 0`）でエラーが返されることを検証するテストを追加する
  - `docs/specification.md` の剰余演算子セクションに浮動小数点対応の記述を追加する
  - `docs/backlog.md` から剰余演算子の課題を削除する
  - _Requirements: 1.1, 1.2, 1.3, 6.1, 6.2, 6.3_

- [x] 2. delete 関数の実装
- [x] 2.1 (P) マップからキーを削除する `delete` 組み込み関数を実装する
  - 引数が 2 つ（マップとキー）であることを検証し、不正な場合は型エラーを返す
  - 指定キーがマップに存在する場合は削除して `true` を返す
  - 存在しないキーの場合は `false` を返す（エラーにしない）
  - 正常系・異常系・存在しないキーのテストを追加する
  - `docs/specification.md` にマップ操作セクションとして `delete` を追記する
  - `docs/backlog.md` からキー削除機能の課題を削除する
  - _Requirements: 2.1, 2.2, 2.3, 2.4, 6.1, 6.2, 6.3_

- [ ] 3. 文字列操作関数の実装
- [x] 3.1 (P) 基本的な文字列操作関数（split, join, trim, replace）を実装する
  - `split(str, sep)`: 文字列を区切り文字で分割して配列を返す
  - `join(arr, sep)`: 配列要素を区切り文字で結合して文字列を返す
  - `trim(str)`: 前後の空白を除去した文字列を返す
  - `replace(str, old, new)`: すべての一致箇所を置換した文字列を返す
  - 引数の型が不正な場合はエラーを返す
  - 空文字列・空配列・マルチバイト文字のテストを含める
  - _Requirements: 3.1, 3.2, 3.3, 3.4, 3.9_

- [ ] 3.2 (P) rune 対応の文字列操作関数（substring, indexOf）を実装する
  - `substring(str, start, end)`: rune 単位で部分文字列を返す（日本語などマルチバイト文字対応）
  - `indexOf(str, substr)`: rune 単位の開始位置を返す（見つからない場合は `-1`）
  - 範囲外インデックスに対してはエラーを返す
  - マルチバイト文字（日本語）でのインデックス計算が正しいことをテストで検証する
  - _Requirements: 3.5, 3.6, 3.9_

- [ ] 3.3 (P) 大文字・小文字変換関数（toUpper, toLower）を実装する
  - `toUpper(str)`: すべての文字を大文字に変換する
  - `toLower(str)`: すべての文字を小文字に変換する
  - 引数が文字列以外の場合はエラーを返す
  - ASCII・マルチバイト文字のテストを含める
  - _Requirements: 3.7, 3.8, 3.9_

- [ ] 3.4 文字列操作関数の仕様ドキュメントを更新する
  - `docs/specification.md` に 8 つの文字列操作関数を追記する
  - `docs/backlog.md` から文字列操作関連の課題を削除する
  - _Requirements: 6.1, 6.2_

- [ ] 4. 数学関数の実装
- [ ] 4.1 (P) 単項数学関数（abs, floor, ceil, round, sqrt）を実装する
  - `abs(x)`: 絶対値を返す
  - `floor(x)`: 負の無限大方向への切り捨て（`floor(-3.7)` → `-4`）
  - `ceil(x)`: 正の無限大方向への切り上げ
  - `round(x)`: 四捨五入
  - `sqrt(x)`: 平方根
  - 引数が数値以外の場合はエラーを返す
  - `floor` と既存の `int()` の違い（Truncation vs Floor）をテストで検証する
  - _Requirements: 4.1, 4.2, 4.3, 4.4, 4.8, 4.10_

- [ ] 4.2 (P) 可変長引数の数学関数（min, max）と 2 引数関数（pow）を実装する
  - `min(a, b, ...)`: 可変長引数の最小値を返す（引数 0 個はエラー）
  - `max(a, b, ...)`: 可変長引数の最大値を返す（引数 0 個はエラー）
  - `pow(x, y)`: x の y 乗を返す
  - 数値以外の引数に対してはエラーを返す
  - 単一引数・複数引数・負数のテストを含める
  - _Requirements: 4.5, 4.6, 4.9, 4.10_

- [ ] 4.3 (P) 乱数関数（random）を実装する
  - `random()`: 0 以上 1 未満の乱数を返す
  - 引数が渡された場合はエラーを返す
  - 戻り値が 0 以上 1 未満であることをテストで検証する
  - _Requirements: 4.7, 4.10_

- [ ] 4.4 数学関数の仕様ドキュメントを更新する
  - `docs/specification.md` に 9 つの数学関数を追記する
  - `docs/backlog.md` から数学関数関連の課題を削除する
  - _Requirements: 6.1, 6.2_

- [ ] 5. for-in ループの実装
- [ ] 5.1 for-in ループの AST ノードを定義する
  - `ForInStatement` 構造体を追加する（Key, Value, Iterable, Body フィールド）
  - `statementNode()`, `TokenLiteral()`, `String()` メソッドを実装する
  - 単一変数形式と 2 変数形式を AST レベルで区別できるようにする（Value が nil なら単一変数）
  - _Requirements: 5.8_

- [ ] 5.2 for-in 構文のパーサーを実装する
  - `parseForStatement` 内で for-in を検出する分岐を追加する
  - `(` の後の IDENT の次が `"in"` なら単一変数 for-in としてパースする
  - `(` の後の IDENT の次が `,` なら 2 変数 for-in としてパースする
  - `in` は予約語にせず、コンテキスト依存で判定する（`in()` 組み込み関数との互換性維持）
  - 単一変数・2 変数形式のパーサーテストを追加する
  - 既存の for 文のパースが影響を受けないことを回帰テストで確認する
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.8_

- [ ] 5.3 for-in ループの評価器を実装する
  - 配列の単一変数イテレーション: 各要素を順に変数に束縛する
  - 配列の 2 変数イテレーション: インデックスと要素をペアで束縛する
  - マップの単一変数イテレーション: 各キーを変数に束縛する
  - マップの 2 変数イテレーション: キーと値をペアで束縛する
  - イテレーション変数を `const` として設定し、ループ内での再代入を禁止する
  - `break` でループを即座に終了する
  - `continue` で次のイテレーションにスキップする
  - `return` をループ内から正しく伝播する
  - 対象が Array/Map 以外の場合はエラーを返す
  - 空配列・空マップのイテレーションが正しく動作することをテストする
  - _Requirements: 5.1, 5.2, 5.3, 5.4, 5.5, 5.6, 5.7_

- [ ] 5.4 for-in ループの仕様ドキュメントを更新する
  - `docs/specification.md` に for-in ループの構文・動作を追記する
  - `docs/backlog.md` を更新する
  - _Requirements: 6.1, 6.2_
